{% extends "base.jinja2" %}
{% block title %}User Information{% endblock %}


{% block top %}

<div class="container">
  <h1>{{ user.name }}</h1>
</div>

{% endblock %}


{% block content %}

{{ user_info_block|safe }}

{# Display the transaction history list
 #}
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Transaction History</h3>
  </div>
  <div class="panel-body">

    <ul id="transaction-history" class="list-group">

      
      {# Iterate all of the transactions in the user's history.
       #}
      {% for transaction in transactions|reverse %}

      <li class="list-group-item">
        {{ transaction.type }} | {{ transaction.timestamp }}
        <button type="button" id="btn-trans-{{ transaction.id }}" class="btn btn-default btn-trans-showhide">Show</button>

        {# Choose what content to display based on the type of transaction
         # it is.
         #}
        {% if transaction.type == "purchase" %}

        {# Show a purchase transaction
         #}
        <div id="transaction-{{ transaction.id }}" style="display:none;">
          <table class="table">

            <thead>
              <tr>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Item Price</th>
                <th>Total Price</th>
              </tr>
            </thead>

            <tbody>
              {% for line_item in transaction.subtransactions %}
              <tr class="purchase-item">
                <td class="item-title">{{ line_item.item.name }}</td>
                <td class="item-quantity">{{ line_item.quantity }}</td>
                <td class="item-price">{{ line_item.item.price|format_currency|safe }}</td>
                <td class="item-total">{{ line_item.amount|format_currency|safe }}</td>
              </tr>
              {% endfor %}
            </tbody>

            <tfoot>
              <td colspan="3">Total</td>
              <td>{{ transaction.amount|format_currency|safe }}</td>
            </tfoot>

          </table>
        </div>

        {% elif transaction.type == "deposit" %}

        {# Show a deposit transaction
         #}
        <div id="transaction-{{ transaction.id }}" style="display:none;">
          <div class="row">
            <div class="col-md-4">Deposit</div>
            <div class="col-md-4">{{ transaction.amount|format_currency|safe }}</div>
          </div>
        </div>

        {% endif %}

      </li>

      {% endfor %}

      {% if transactions|length == 0 %}
      <li class="list-group-item">
        No transactions.
      </li>
      {% endif %}

    </ul>

  </div>
</div>

{% endblock %}

