{% extends "base.jinja2" %}
{% import "macro_buttons.jinja2" as button %}
{% import "macro_graph.jinja2" as graph %}

{% block title %}Home{% endblock %}


{% block top %}

<h1 class="page-header">Chez Betty Admin Panel</h1>

{% endblock %}


{% block content %}
<div class="row">
  <div class="col-md-5">

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Account Information</h3>
      </div>
      <div class="panel-body">

        <div class="row">
          <div class="col-md-6">
            <table class="table">
              <thead>
                <tr>
                  <th colspan="2">Virtual Accounts</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Chez Betty</td>
                  <td class="right">{{ chezbetty.balance|format_currency|safe }}</td>
                </tr>
                <tr>
                  <td>Users</td>
                  <td class="right">{{ users_balance|format_currency|safe }}</td>
                </tr>
                <tr>
                  <td>Users Owe</td>
                  <td class="right">{{ owed_by_users|format_currency|safe }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="col-md-6">
            <table class="table">
              <thead>
                <tr>
                  <th colspan="2">Cash Accounts</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Chez Betty</td>
                  <td class="right">{{ chezbetty_cash.balance|format_currency|safe }}</td>
                </tr>
                <tr>
                  <td>Cash Box</td>
                  <td class="right">{{ cashbox.balance|format_currency|safe }}</td>
                </tr>
                <tr>
                  <td>Bitcoin Box</td>
                  <td class="right">{{ btcbox.balance|format_currency|safe }}</td>
                </tr>
                <tr>
                  <td>Users Cash</td>
                  <td class="right">{{ held_for_users|format_currency|safe }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div class="col-md-4">

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Assets</h3>
      </div>
      <div class="panel-body">

        <table class="table">
          <tbody>
            <tr>
              <td>Cash</td>
              <td class="right">{{ chezbetty_cash.balance|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Coinbase</td>
              {% if btc_balance.mbtc is none %}
                <td class="right">Error loading BTC Value</td>
              {% else %}
                <td class="right">{{ btc_balance.mbtc }} mBTC ({{ btc_balance.usd|format_currency|safe }})</td>
              {% endif %}
            </tr>
            <tr>
              <td>Inventory (Wholesale)</td>
              <td class="right">{{ inventory.wholesale|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Inventory (Price)</td>
              <td class="right">{{ inventory.price|format_currency|safe }}</td>
            </tr>

          </tbody>
        </table>

      </div>
    </div>
  </div>

  <div class="col-md-3">

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Cash Summary</h3>
      </div>
      <div class="panel-body">

        <table class="table">
          <tbody>
            <tr>
              <td>Cashbox Net</td>
              <td class="right">{{ cashbox_net|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Bitcoin Net</td>
              <td class="right">{{ btcbox_net|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Chezbetty Misc Net</td>
              <td class="right">{{ chezbetty_net|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Store</td>
              <td class="right">{{ restock.balance|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Donation</td>
              <td class="right">{{ donation.balance|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Withdrawal</td>
              <td class="right">{{ withdrawal.balance|format_currency|safe }}</td>
            </tr>
          </tbody>
        </table>

      </div>
    </div>
  </div>
</div>


<div class="row">
  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Stats</h3>
      </div>
      <div class="panel-body">
        <table class="table table-condensed">
          <tbody>
            <tr>
              <td>Total Sales</td>
              <td class="right">{{ total_sales|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Profit on Sales</td>
              <td class="right">{{ profit_on_sales|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Inventory Lost</td>
              <td class="right">{{ total_inventory_lost|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Total Cash Deposits</td>
              <td class="right">{{ total_cash_deposits|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Total BTC Deposits</td>
              <td class="right">{{ total_btc_deposits|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>Projected Profit</td>
              <td class="right">{{ ((inventory.price - users_balance) + chezbetty_cash.balance + cashbox.balance + btcbox.balance)|format_currency|safe }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Year-to-Date</h3>
      </div>
      <div class="panel-body">
        <table class="table table-condensed">
          <tbody>
            <tr>
              <td>YTD Sales</td>
              <td class="right">{{ ytd_sales|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>YTD Profit on Sales</td>
              <td class="right">{{ ytd_profit|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>YTD Inventory Lost</td>
              <td class="right">{{ ytd_lost|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>YTD Total Deposits</td>
              <td class="right">{{ ytd_dep|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>YTD Total Cash Deposits</td>
              <td class="right">{{ ytd_dep_cash|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>YTD Total BTC Deposits</td>
              <td class="right">{{ ytd_dep_btc|format_currency|safe }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Month-to-Date</h3>
      </div>
      <div class="panel-body">
        <table class="table table-condensed">
          <tbody>
            <tr>
              <td>MTD Sales</td>
              <td class="right">{{ mtd_sales|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>MTD Profit on Sales</td>
              <td class="right">{{ mtd_profit|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>MTD Inventory Lost</td>
              <td class="right">{{ mtd_lost|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>MTD Total Deposits</td>
              <td class="right">{{ mtd_dep|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>MTD Total Cash Deposits</td>
              <td class="right">{{ mtd_dep_cash|format_currency|safe }}</td>
            </tr>
            <tr>
              <td>MTD Total BTC Deposits</td>
              <td class="right">{{ mtd_dep_btc|format_currency|safe }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  
</div>


<div class="row">
  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><a href="/admin/users/edit?sort=balance">Wall of Shame Overview</a></h3>
      </div>
      <div class="panel-body">
        <table class="table table-condensed table-striped">
          <thead>
            <tr>
              <th>User</th>
              <th class="right" style="width:20%;">Balance</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users_shame %}
            <tr>
              <td>{{ user|make_link(33)|safe }}</td>
              <td class="right">{{ user.balance|format_currency|safe }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><a href="/admin/items/edit?sort=stock">Low Stock Items</a></h3>
      </div>
      <div class="panel-body">
        <table class="table table-condensed table-striped">
          <thead>
            <tr>
              <th>Item</th>
              <th class="right" style="width:20%;">Stock</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items_low_stock %}
            <tr>
              <td>{{ item|make_link(33)|safe }}</td>
              <td class="right">{{ item.in_stock }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><a href="/admin/items/edit?sort=sold&amp;direction=desc">Best Selling Items</a></h3>
      </div>
      <div class="panel-body">
        <table class="table table-condensed table-striped">
          <thead>
            <tr>
              <th>Item</th>
              <th class="right" style="width:20%;">Sold</th>
            </tr>
          </thead>
          <tbody>
            {% for item in best_selling_items %}
            <tr>
              <td>{{ item[1]|make_link(33)|safe }}</td>
              <td class="right">{{ item.quantity }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

      </div>
    </div>
  </div>
</div>


<div class="row">

  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><a href="/admin/events">Recent Transactions</a></h3>
      </div>
      <div class="panel-body">
        <table class="table table-condensed table-striped table-responsive filterable">
          <thead>
            <tr>
              <th></th>
              <th>Timestamp</th>
              <th class="filterable-row">Type</th>
              <th class="filterable-row">From Account:</th>
              <th class="filterable-row">To Account:</th>
              <th class="filterable-row">From Account (Cash):</th>
              <th class="filterable-row">To Account (Cash):</th>
              <th class="right">Amount</th>
            </tr>
          </thead>
          <tbody>
            {% for e in events %}
            {% for t in e.transactions|reverse %}
            <tr>
              <td>{{ button.event(e.id) }}</td>
              <td>{{ e.timestamp|pretty_date|safe }}</td>
              <td>{{ t.type }}</td>
              <td>{{ t.fr_account_virt|make_link|safe if t.fr_account_virt else "n/a" }}</td>
              <td>{{ t.to_account_virt|make_link|safe if t.to_account_virt else "n/a" }}</td>
              <td>{{ t.fr_account_cash|make_link|safe if t.fr_account_cash else "n/a" }}</td>
              <td>{{ t.to_account_cash|make_link|safe if t.to_account_cash else "n/a" }}</td>
              <td class="right">{{ t.amount|format_currency|safe }}</td>
            </tr>
            {% endfor %}
            {% endfor %}
          </tbody>
        </table>
        </div>
    </div>
  </div>

</div>

<div class="row">
  <div class="col-md-4">
  {{ graph.create_graph_panel(graph_items_day.xs, graph_items_day.ys, graph_items_day.avg_hack, "Items sold per day") }}
  </div>
  <div class="col-md-4">
  {{ graph.create_graph_panel(graph_sales_day.xs, graph_sales_day.ys, graph_sales_day.avg_hack, "Sales per day") }}
  </div>
  <div class="col-md-4">
  {{ graph.create_graph_panel(graph_deposits_day.xs, graph_deposits_day.ys, graph_deposits_day.avg_hack, "Deposits per day") }}
  </div>
</div>


{% endblock %}
