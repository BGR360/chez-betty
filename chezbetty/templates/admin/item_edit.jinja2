{% extends "base.jinja2" %}
{% import "macro_buttons.jinja2" as button %}
{% set active_page = 'items_edit' %}
{% block title %}Edit Item{% endblock %}

{% block top %}
<h1 class="page-header">Edit Item</h1>
{% endblock %}


{% block content %}

<form role="form" action="/admin/item/edit/submit" method="post" id="form-edit-item">
  <input type="hidden" id="item-id" name="item-id" value="{{ item.id }}">

  <div class="panel panel-default">
    <div class="panel-heading">Item Details</div>
    <div class="panel-body">
      <dl class="dl-horizontal">
        <dt>Name</dt>
        <dd><input type="text" class="form-control" id="item-name" name="item-name" value="{{ item.name }}"></dd>

        <dt>Barcode</dt>
        <dd><input type="text" class="form-control barcode-check" id="item-barcode" name="item-barcode" value="{{ item.barcode if item.barcode != None }}"></dd>

        <dt>Price</dt>
        <dd><input type="text" class="form-control numeric" id="item-price" name="item-price" value="{{ item.price|round(2) }}"></dd>

        <dt>Wholesale</dt>
        <dd><input type="text" class="form-control numeric" id="item-wholesale" name="item-wholesale" value="{{ item.wholesale|round(4) }}"></dd>

        <dt>In Stock</dt>
        <dd><input type="text" class="form-control numeric" disabled value="{{ item.in_stock }}"></input></dd>

        <hr />
        <dt>Enabled</dt>
        <dd><input type="checkbox" id="admin-item-enable-{{ item.id }}" class="admin-switch toggle-disabled" {% if item.enabled == True %}checked="checked"{% endif %}></input></dd>
      </dl>
    </div>

    <ul class="list-group">

      <table class="table">

        <thead>
          <tr>
            <th>Vendor</th>
            <th>Product Num</th>
          </tr>
        </thead>

        <tbody>

          {% for v in item.vendors %}
          {% if v.enabled %}
          <tr>

            <td>{{ v.vendor.name }} <input type="hidden" name="item-vendor-id-{{ v.id}}" value="{{ v.vendor_id }}"></td>
            <td>
              <input type="text" class="form-control" id="item-vendor-item_num-{{ v.id }}" name="item-vendor-item_num-{{ v.id }}" value="{{ v.item_number }}">
            </td>

          </tr>
          {% endif %}
          {% endfor %}

          {% if new_vendors %}
          <tr>

            <td>
              <select class="form-control" id="item-vendor-id-new" name="item-vendor-id-new">
                {% for vendor in new_vendors %}
                <option value="{{ vendor.id }}">{{ vendor.name }}</option>
                {% endfor %}
              </select>
            </td>
            <td>
              <input type="text" class="form-control" id="item-vendor-item_num-new" name="item-vendor-item_num-new">
            </td>

          </tr>
          {% endif %}

        </tbody>
      </table>
    </ul>

    <button type="submit" class="btn btn-success">Update Item</button>

  </div>

  <div class="panel panel-default">
    <div class="panel-heading">Item History</div>
    <div class="panel-body">

    <table class="table table-striped">
      <thead>
        <tr>
          <th></th>
          <th>Date</th>
          <th>User</th>
          <th>Type</th>
          <th>Quantity</th>
        </tr>
      </thead>

      <tbody>
        {% for subtrans in subtransactions|reverse %}
        <tr>
          <td>{{ button.event(subtrans.transaction.event.id) }}</td>
          <td>{{ subtrans.transaction.event.timestamp|pretty_date|safe }}</td>
          <td>{{ subtrans.transaction.event.admin.name }}</td>
          <td>{{ subtrans.transaction.type }}</td>
          {% if subtrans.transaction.type == "inventory" %}
          <td>{{ subtrans.quantity_counted }}</td>
          {% else %}
          <td>{{ subtrans.quantity }}</td>
          {% endif %}
        </tr>
        {% endfor %}
        {% for sst in subsubtransactions|reverse %}
        <tr>
          <td>{{ button.event(sst.subtransaction.transaction.event.id) }}</td>
          <td>{{ sst.subtransaction.transaction.event.timestamp|pretty_date|safe }}</td>
          <td>{{ sst.subtransaction.transaction.event.admin.name }}</td>
          <td>{{ sst.subtransaction.transaction.type }}</td>
          <td>{{ sst.quantity }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">Barcodes</div>
    <div class="panel-body">
      <p>Barcodes are designed for sheets of 1.5&rdquo; &times; 1&rdquo; labels and will print 50 labels per sheet.</p>
      <p>They have been tested with the <tt>OL1000WS</tt> labels from <a href="http://www.onlinelabels.com/Products/OL1000WS.htm">OnlineLabels.com</a>.</p>
      <p style="color: red;">Remember to deselect any &ldquo;Fit to Page&rdquo; options in print settings!</p>
      <a href="/admin/item/barcode/{{ item.id }}.pdf" class="btn btn-default">Print Barcodes for Item</a>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">Boxes the Item is in</div>
    <div class="panel-body">

    <table class="table table-striped">
      <thead>
        <tr>
          <th></th>
          <th>Box</th>
          <th>Quantity</th>
        </tr>
      </thead>

      <tbody>
        {% for boxitem in item.boxes %}
        <tr>
          <td>{{ button.box(boxitem.box.id) }}</td>
          <td>{{ boxitem.box|make_link|safe }}</td>
          <td>{{ boxitem.quantity }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    </div>
  </div>


</form>

{% if can_delete %}
<a href="/admin/item/delete/{{ item.id }}" class="btn btn-danger">Permanently Delete this Item</a>
{% endif %}

{% endblock %}

{% block onload %}
<script src="{{'chezbetty:static/js/chezbetty-admin-keyboard.js'|static_url}}"></script>
{% endblock %}
